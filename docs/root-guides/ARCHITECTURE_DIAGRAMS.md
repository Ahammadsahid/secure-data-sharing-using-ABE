# ğŸ—ï¸ System Architecture & Flow Diagrams

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸ–¥ï¸ USER'S BROWSER                         â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    React Frontend                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚  â”‚  â”‚   Login      â”‚   Dashboard  â”‚  Download    â”‚            â”‚  â”‚
â”‚  â”‚  â”‚   Register   â”‚   Upload     â”‚  Features    â”‚            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚  â”‚  localhost:3000                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                     â”‚
â”‚                     [Axios HTTP Calls]                            â”‚
â”‚                              â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ğŸ” User Auth      â”‚   â”‚  ğŸ“ File Access  â”‚
        â”‚  - Login           â”‚   â”‚  - Upload        â”‚
        â”‚  - Register        â”‚   â”‚  - Download      â”‚
        â”‚  - Attributes      â”‚   â”‚  - Decrypt       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ğŸ—„ï¸  SQLite DB     â”‚   â”‚  ğŸ”— Blockchain Layer  â”‚
        â”‚                    â”‚   â”‚                        â”‚
        â”‚  Users:            â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”œâ”€ id             â”‚   â”‚  â”‚  KeyAuthority  â”‚   â”‚
        â”‚  â”œâ”€ username       â”‚   â”‚  â”‚  Smart         â”‚   â”‚
        â”‚  â”œâ”€ password       â”‚   â”‚  â”‚  Contract      â”‚   â”‚
        â”‚  â”œâ”€ role âœ…        â”‚   â”‚  â”‚  - 7 Auth      â”‚   â”‚
        â”‚  â”œâ”€ department âœ…  â”‚   â”‚  â”‚  - 4-of-7      â”‚   â”‚
        â”‚  â””â”€ clearance âœ…   â”‚   â”‚  â”‚    Threshold   â”‚   â”‚
        â”‚                    â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚  Files:            â”‚   â”‚         â”‚             â”‚
        â”‚  â”œâ”€ id             â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”‚
        â”‚  â”œâ”€ filename       â”‚   â”‚   â”‚  Ganache   â”‚      â”‚
        â”‚  â”œâ”€ policy         â”‚   â”‚   â”‚  Local     â”‚      â”‚
        â”‚  â”œâ”€ enc_key        â”‚   â”‚   â”‚  Ethereum  â”‚      â”‚
        â”‚  â””â”€ file_path      â”‚   â”‚   â”‚  :7545     â”‚      â”‚
        â”‚                    â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–²                            â–²
              â”‚                            â”‚
        [Query/Update]           [Contract Calls]
              â”‚                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚
    FastAPI Server          Web3.py Client
    127.0.0.1:8000         (Python)
```

---

## User Registration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Registration  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Register Page Input             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Username (min 3 chars)        â”‚
â”‚  â€¢ Password (min 6 chars)        â”‚
â”‚  â€¢ Role (admin/manager/etc)      â”‚
â”‚  â€¢ Department (IT/Finance/etc) âœ… NEW â”‚
â”‚  â€¢ Clearance (high/medium/low) âœ… NEW â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validation                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ Username not taken            â”‚
â”‚  âœ“ Password min length           â”‚
â”‚  âœ“ All fields filled             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Processing              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Hash password (bcrypt)       â”‚
â”‚  2. Create User record:          â”‚
â”‚     - username                   â”‚
â”‚     - password_hash              â”‚
â”‚     - role                       â”‚
â”‚     - department âœ… NEW          â”‚
â”‚     - clearance âœ… NEW           â”‚
â”‚  3. Store in SQLite DB           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Success                      â”‚
â”‚  User registered with attributes â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Login & Dashboard Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Login Page Input   â”‚
â”‚  â€¢ Username         â”‚
â”‚  â€¢ Password         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Verification            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Find user by username        â”‚
â”‚  2. Verify password hash         â”‚
â”‚  3. Return user data:            â”‚
â”‚     - username                   â”‚
â”‚     - role                       â”‚
â”‚     - department âœ…              â”‚
â”‚     - clearance âœ…               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Storage (localStorage) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  localStorage.setItem(            â”‚
â”‚    "username": "admin",          â”‚
â”‚    "role": "admin",              â”‚
â”‚    "department": "IT",           â”‚
â”‚    "clearance": "high"           â”‚
â”‚  )                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard Displayed             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Welcome, admin!                 â”‚
â”‚                                  â”‚
â”‚  Your Attributes:                â”‚
â”‚  â€¢ Role: admin âœ…                â”‚
â”‚  â€¢ Department: IT âœ…             â”‚
â”‚  â€¢ Clearance: High âœ…            â”‚
â”‚  â€¢ Status: ğŸŸ¢ Authenticated      â”‚
â”‚                                  â”‚
â”‚  Actions:                        â”‚
â”‚  â€¢ Upload (green - enabled) âœ…   â”‚
â”‚  â€¢ Download (blue - enabled)     â”‚
â”‚  â€¢ Logout (red)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Upload Flow (Admin Only)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FILE UPLOAD FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Check: Is Admin?   â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         YES   â”‚      â”‚  NO
               â”‚      â”‚
              âœ…      âŒ
               â”‚      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚Upload â”‚  â”‚ Access Denied Page   â”‚
        â”‚Form   â”‚  â”‚ "Only admin can      â”‚
        â””â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚  upload files"       â”‚
          â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Select File & Attributes             â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ File: test.pdf âœ“                     â”‚
   â”‚                                      â”‚
   â”‚ Select Roles:                        â”‚
   â”‚  â˜‘ admin      â˜‘ manager              â”‚
   â”‚  â˜ accountant â˜ employee â˜ worker   â”‚
   â”‚                                      â”‚
   â”‚ Select Departments:                  â”‚
   â”‚  â˜‘ IT         â˜‘ Finance              â”‚
   â”‚  â˜ HR         â˜ Operations           â”‚
   â”‚                                      â”‚
   â”‚ Select Clearance:                    â”‚
   â”‚  â˜‘ high       â˜ medium â˜ low        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Build ABE Policy                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ Policy = (role:admin OR role:manager)â”‚
   â”‚          AND                         â”‚
   â”‚          (dept:IT OR dept:Finance)   â”‚
   â”‚          AND                         â”‚
   â”‚          (clearance:high)            â”‚
   â”‚                                      â”‚
   â”‚ Only users matching ALL conditions   â”‚
   â”‚ can decrypt this file                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend Processing                   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ 1. Generate AES-256 key              â”‚
   â”‚ 2. Encrypt file:                     â”‚
   â”‚    - Generate random IV (16 bytes)   â”‚
   â”‚    - IV + AES_encrypt(file, key)     â”‚
   â”‚ 3. Encrypt AES key with ABE:         â”‚
   â”‚    - encrypted_key = ABE_encrypt(    â”‚
   â”‚      aes_key, policy)                â”‚
   â”‚ 4. Store:                            â”‚
   â”‚    - File to disk: IV + ciphertext   â”‚
   â”‚    - Metadata to DB: policy, enc_key â”‚
   â”‚    - Return: File ID                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ âœ… Success                           â”‚
   â”‚ File uploaded with ABE policy        â”‚
   â”‚ File ID: 1                           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Download with Blockchain Approval Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DOWNLOAD FLOW (3 STEPS)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Display User Attributes      â”‚
        â”‚                              â”‚
        â”‚ Role: admin                  â”‚
        â”‚ Department: IT               â”‚
        â”‚ Clearance: high              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â•â•â•â•â•â•â•â•â•â•â•â•³â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â•‘  STEP 1: Request Approval    â•‘
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Backend: request-key-approval  â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ 1. Get file from DB            â”‚
        â”‚ 2. Get file policy            â”‚
        â”‚ 3. Check user attributes      â”‚
        â”‚    against policy             â”‚
        â”‚                               â”‚
        â”‚    Policy:                    â”‚
        â”‚    (role:admin) AND           â”‚
        â”‚    (dept:IT) AND              â”‚
        â”‚    (clearance:high)           â”‚
        â”‚                               â”‚
        â”‚    User attributes:           â”‚
        â”‚    role:admin âœ… MATCH        â”‚
        â”‚    dept:IT âœ… MATCH           â”‚
        â”‚    clearance:high âœ… MATCH    â”‚
        â”‚                               â”‚
        â”‚ 4. âœ… All match!              â”‚
        â”‚ 5. Generate Key ID            â”‚
        â”‚ 6. Initialize approval        â”‚
        â”‚    request on blockchain      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Response to Frontend           â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ {                              â”‚
        â”‚   "key_id": "0x1234...",       â”‚
        â”‚   "authorities": [             â”‚
        â”‚     "0x266E6E85ae9D...",       â”‚
        â”‚     "0x8F29929fC709...",       â”‚
        â”‚     ... (7 total)              â”‚
        â”‚   ],                           â”‚
        â”‚   "threshold": 4,              â”‚
        â”‚   "status": "pending"          â”‚
        â”‚ }                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â•â•â•â•â•â•â•â•â•â•â•â•³â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â•‘  STEP 2: Simulate Approvals   â•‘
        â•‘  (Local Ganache, for testing) â•‘
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Backend: simulate-approvals    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ For each authority (4 of 7):   â”‚
        â”‚                                â”‚
        â”‚ 1. Call blockchain:            â”‚
        â”‚    contract.approveKey(        â”‚
        â”‚      key_id,                   â”‚
        â”‚      from=authority_address    â”‚
        â”‚    )                           â”‚
        â”‚                                â”‚
        â”‚ 2. Transaction sent to Ganache â”‚
        â”‚    at http://127.0.0.1:7545    â”‚
        â”‚                                â”‚
        â”‚ 3. Ganache mines block         â”‚
        â”‚                                â”‚
        â”‚ 4. Transaction stored:         â”‚
        â”‚    âœ… TX 1 from Authority 1    â”‚
        â”‚    âœ… TX 2 from Authority 2    â”‚
        â”‚    âœ… TX 3 from Authority 3    â”‚
        â”‚    âœ… TX 4 from Authority 4    â”‚
        â”‚                                â”‚
        â”‚ 5. 4-of-7 threshold met âœ…   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â•â•â•â•â•â•â•â•â•â•â•â•³â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â•‘  STEP 3: Download Decrypted   â•‘
        â•‘          File                  â•‘
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Backend: /files/download       â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ 1. Get encrypted file from DB  â”‚
        â”‚ 2. Verify blockchain approval: â”‚
        â”‚    - Call contract             â”‚
        â”‚    - Check: approvals >= 4    â”‚
        â”‚    âœ… YES                      â”‚
        â”‚                                â”‚
        â”‚ 3. Get encrypted AES key       â”‚
        â”‚ 4. Decrypt AES key with ABE:  â”‚
        â”‚    - User attributes match    â”‚
        â”‚    - aes_key = ABE_decrypt(   â”‚
        â”‚        enc_key, user_attrs)   â”‚
        â”‚                                â”‚
        â”‚ 5. Load encrypted file:        â”‚
        â”‚    - IV (first 16 bytes)       â”‚
        â”‚    - ciphertext (rest)         â”‚
        â”‚                                â”‚
        â”‚ 6. Decrypt file:               â”‚
        â”‚    - plaintext = AES_decrypt(  â”‚
        â”‚        ciphertext, aes_key,IV) â”‚
        â”‚                                â”‚
        â”‚ 7. Send to browser:            â”‚
        â”‚    - Content-Type:             â”‚
        â”‚      application/octet-stream  â”‚
        â”‚    - Content-Disposition:      â”‚
        â”‚      attachment; filename=...  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ğŸ“¥ Browser Downloads File      â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ File saved to Downloads:       â”‚
        â”‚ secure_file_1.pdf              â”‚
        â”‚                                â”‚
        â”‚ âœ… SUCCESS                     â”‚
        â”‚ File decrypted and downloaded  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Access Denied Scenario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User: bob (Finance, medium)       â”‚
â”‚  Tries to download:                â”‚
â”‚  File policy: (role:admin) AND     â”‚
â”‚               (dept:IT) AND        â”‚
â”‚               (clearance:high)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 1: Request... â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check Policy Match:            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Required: role:admin           â”‚
    â”‚ User has: role:user            â”‚
    â”‚ âŒ NO MATCH!                   â”‚
    â”‚                                â”‚
    â”‚ Required: dept:IT              â”‚
    â”‚ User has: dept:Finance         â”‚
    â”‚ âŒ NO MATCH!                   â”‚
    â”‚                                â”‚
    â”‚ Required: clearance:high       â”‚
    â”‚ User has: clearance:medium     â”‚
    â”‚ âŒ NO MATCH!                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âŒ ERROR RESPONSE              â”‚
    â”‚                                â”‚
    â”‚ "Access denied by policy"      â”‚
    â”‚                                â”‚
    â”‚ User attributes don't match    â”‚
    â”‚ file access policy             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User       â”‚
â”‚   (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ User fills form with:
         â”‚ - File to upload
         â”‚ - Role selection
         â”‚ - Department selection  âœ… NEW
         â”‚ - Clearance selection   âœ… NEW
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Frontend     â”‚
    â”‚   (React)      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Validates      â”‚
    â”‚ Builds policy  â”‚
    â”‚ Sends to API   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    [Axios POST /files/upload]
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend Route   â”‚
    â”‚  (FastAPI)       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ 1. Auth check    â”‚
    â”‚ 2. Read file     â”‚
    â”‚ 3. Gen AES key   â”‚
    â”‚ 4. Encrypt file  â”‚
    â”‚ 5. Encrypt key   â”‚
    â”‚ 6. Store to DB   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚             â”‚              â”‚
             â–¼             â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ SQLite â”‚  â”‚ File     â”‚  â”‚ Blockchain â”‚
        â”‚ DB     â”‚  â”‚ Storage  â”‚  â”‚ (optional) â”‚
        â”‚        â”‚  â”‚          â”‚  â”‚            â”‚
        â”‚ User   â”‚  â”‚ IV +     â”‚  â”‚ Log events â”‚
        â”‚ File   â”‚  â”‚ Cipher   â”‚  â”‚            â”‚
        â”‚ Metadata â”‚ text      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Download Flow:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User       â”‚
â”‚  (Requests   â”‚
â”‚   download)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check Attributes:  â”‚
    â”‚ â€¢ role             â”‚
    â”‚ â€¢ department âœ…    â”‚
    â”‚ â€¢ clearance âœ…     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    Compare with File Policy
             â”‚
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Match?  â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        YES  â”‚            â”‚  NO
             â”‚            â”‚
             â–¼            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    âŒ Error
        â”‚ âœ…     â”‚
        â”‚Decrypt â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
             â”‚
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Download â”‚
        â”‚ to user  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Authentication & Authorization

```
AUTHENTICATION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Who are you?                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Verify username + password      â”‚
â”‚ Return user record with:        â”‚
â”‚ - username                      â”‚
â”‚ - role                          â”‚
â”‚ - department âœ… NEW             â”‚
â”‚ - clearance âœ… NEW              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AUTHORIZATION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ What can you do?                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Check user attributes against   â”‚
â”‚ file access policy:             â”‚
â”‚                                 â”‚
â”‚ User Attributes:                â”‚
â”‚ - role: admin                   â”‚
â”‚ - department: IT âœ… NEW         â”‚
â”‚ - clearance: high âœ… NEW        â”‚
â”‚                                 â”‚
â”‚ File Policy:                    â”‚
â”‚ (role:admin) AND                â”‚
â”‚ (dept:IT) AND âœ… NEW            â”‚
â”‚ (clearance:high) âœ… NEW         â”‚
â”‚                                 â”‚
â”‚ Result: âœ… ACCESS ALLOWED       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

### Key Improvements:
- âœ… **Multi-attribute ABE** - Roles, departments, clearances
- âœ… **Admin-only uploads** - Enforced on frontend & backend
- âœ… **3-step download flow** - Clear, guided process
- âœ… **Blockchain verification** - 4-of-7 threshold
- âœ… **Modern UI** - Beautiful gradient design
- âœ… **Complete documentation** - Guides and diagrams

### Data Flow:
1. User registers with attributes
2. User logs in â†’ attributes stored in localStorage
3. Admin uploads file â†’ creates ABE policy based on roles, depts, clearances
4. User requests download â†’ attributes checked against policy
5. Blockchain approves â†’ 4 authorities verify
6. File decrypted & downloaded â†’ user gets original file

### Security Layers:
1. **Authentication** - username/password verification
2. **Authorization** - attribute-based policy check
3. **Encryption** - AES-256 for files
4. **ABE** - policy-based key encryption
5. **Blockchain** - 4-of-7 consensus verification

---

**Complete system ready for testing and deployment!** ğŸš€

